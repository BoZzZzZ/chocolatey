<body>
<div id="ipdwrapper"><!-- IPDWRAPPER -->
    <!-- TOP TABS -->
    <?= \Azure\View\Page::include_content('tabs', 'ase/sub'); ?>
    <!-- / TOP TABS -->
    <?= \Azure\View\Page::include_content('trips', 'ase/sub'); ?>
    <div class="outerdiv" id="global-outerdiv"><!-- OUTERDIV -->
        <table cellpadding="0" cellspacing="8" width="100%" id="tablewrap">
            <tbody>
            <tr>
                <?php

                \Azure\Database\Adapter::query("SET NAMES utf8");

                if(isset($_POST['postarticle'])):
					$_POST['text'] = str_replace(['\r', '\n', '\\'], '', $_POST['text']);
                    \Azure\Database\Adapter::secure_query("INSERT INTO `cms_articles` (title,text,image,external_link,link_text,internal_link,description,imagemini,createdate,categories) VALUES (:title,:text,:image,:link,:linktext,:url,:description,:imagemini,:createdate,:categories);",[
                    ':title' => \Azure\View\Misc::escape_text($_POST['title']),
                ':text' => \Azure\View\Misc::escape_text($_POST['text']),
                ':image' => \Azure\View\Misc::escape_text($_POST['image']),
                ':imagemini' => \Azure\View\Misc::escape_text($_POST['imagemini']),
                ':description' => \Azure\View\Misc::escape_text($_POST['description']),
                ':createdate' => time(),
                ':link' => \Azure\View\Misc::escape_text($_POST['link']),
				':url' => \Azure\View\Misc::escape_text($_POST['url']),
				':categories' => \Azure\View\Misc::escape_text($_POST['categories']),
                ':linktext' => \Azure\View\Misc::escape_text($_POST['link_text'])]);
                endif;
                ?>
                <?php if(isset($_POST['postearticle'])):
					$_POST['text'] = str_replace(['\r', '\n', '\\'], '', $_POST['text']);
                    \Azure\Database\Adapter::secure_query("UPDATE cms_articles SET
                    title = :title,
                    text = :text,
                    image = :image,
                    external_link = :link,
					internal_link = :url,
					imagemini = :imagemini,
					description = :description,
					categories = :categories,
                    link_text = :linktext
                    WHERE id = :id",[
                        ':title' => \Azure\View\Misc::escape_text($_POST['title']),
                ':text' => \Azure\View\Misc::escape_text($_POST['text']),
                ':image' => \Azure\View\Misc::escape_text($_POST['image']),
                ':link' => \Azure\View\Misc::escape_text($_POST['link']),
				':url' => \Azure\View\Misc::escape_text($_POST['url']),
                ':linktext' => \Azure\View\Misc::escape_text($_POST['link_text']),
                ':imagemini' => \Azure\View\Misc::escape_text($_POST['imagemini']),
                ':description' => \Azure\View\Misc::escape_text($_POST['description']),
				':categories' => \Azure\View\Misc::escape_text($_POST['categories']),
                ':id' => \Azure\View\Misc::escape_text($_POST['id'])]);
                endif;
                ?>
                <?php if(isset($_GET['rid']))
                \Azure\Database\Adapter::secure_query("DELETE FROM cms_articles WHERE id = :id", [':id' =>
                \Azure\View\Misc::escape_text($_GET['rid'])]);
                ?>
                <?= \Azure\View\Page::include_content('menu', 'ase/site/sub'); ?>
                <td width='78%' valign='top' id='rightblock'>
                    <div><!-- RIGHT CONTENT BLOCK -->
                        <form action='/theallseeingeye/web/articles' method='post' name='theAdminForm'
                              id='theAdminForm'>
                            <input type="hidden" name="addarticle" value="1"/>

                            <div class='tableborder'>
                                <div class='tableheaderalt'>CMS Articles</div>
                                <table cellpadding='4' cellspacing='0' width='100%'>
                                    <tr>
                                        <td class='tablesubheader' width='1%' align='center'>ID</td>
                                        <td class='tablesubheader' width='20%'>Title</td>
                                        <td class='tablesubheader' width='20%' align='center'>Link</td>
                                        <td class='tablesubheader' width='20%' align='center'>Link Url</td>
                                        <td class='tablesubheader' width='1%' align='center'>Edit</td>
                                        <td class='tablesubheader' width='1%' align='center'>Delete</td>
                                    </tr>
                                    <?php foreach(\Azure\Database\Adapter::query("SELECT * FROM cms_articles ORDER BY id DESC") as $row): ?>
                                    <tr>
                                        <td class='tablerow1' align='center'><?php echo $row['id']; ?></td>
                                        <td class='tablerow2'><?php echo $row['title']; ?></td>
                                        <td class='tablerow2' align='center'><?php echo $row['link_text']; ?></td>
                                        <td class='tablerow2' align='center'><?php echo $row['link']; ?></td>
                                        <td class='tablerow2' align='center'><a
                                                href='/theallseeingeye/web/articles/eid/<?php echo $row["id"]; ?>'><img
                                                src='/web-img/ase/images/edit.gif' alt='Edit'></a></td>
                                        <td class='tablerow2' align='center'><a
                                                href='/theallseeingeye/web/articles/rid/<?php echo $row["id"]; ?>'><img
                                                src='/web-img/ase/images/delete.gif' alt='Delete'></a></td>
                                    </tr>
                                    <?php endforeach; ?>
                                </table>
                                <div class='tablefooter' align='center'>
                                    <div class='fauxbutton-wrapper'>
                                        <span class='fauxbutton'><a
                                                onclick="document.getElementById('theAdminForm').submit();">Create new
                                            Article</a></span></div>
                                </div>
                            </div>
                        </form>
                        <?php if(isset($_POST['addarticle'])): ?>
                        <br><br>
                        <script src="//cdn.ckeditor.com/4.4.7/full/ckeditor.js"></script>
                        <form action='/theallseeingeye/web/articles' method='post'>
                            <input type="hidden" name="postarticle" value="1"/>

                            <div class='tableborder'>
                                <div class='tableheaderalt'>Create an Article</div>

                                <table width='100%' cellspacing='0' cellpadding='5' align='center' border='0'>
                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Title</b>

                                            <div class='graytext'>A Title for the Article.</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='title'
                                                                                                 value=""
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Description</b>

                                            <div class='graytext'>A Description for the Article</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='description'
                                                                                                 value=""
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>


                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Text of the Article</b>

                                            <div class='graytext'>The text of the Article.</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><textarea name="text"
                                                                                                    id="text"
                                                                                                    cols='60' rows='5'
                                                                                                    wrap='soft'
                                                                                                    id='sub_desc'
                                                                                                    class='multitext'></textarea>
                                        </td>
                                    </tr>
									
									<tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Categories</b>

                                            <div class='graytext'>Select the Article Categories IDs, separated by comma ','
											The available categories are.: 
											<?php
												foreach(\Azure\Database\Adapter::query("SELECT * FROM cms_articles_categories") as $categories):
													echo 'ID: ' . $categories['id'] . ' NAME: ' . $categories['translate'] . '<br>';
												endforeach;
											?>
											</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='categories' value="1"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Image</b>

                                            <div class='graytext'>A Image for the Article,</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='image' value=""
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Image Thumbnail</b>

                                            <div class='graytext'>A Image Thumbnail for the Article,</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='imagemini' value=""
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>


                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Link Text</b>

                                            <div class='graytext'>A Text for the Link</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='link_text'
                                                                                                 value=""
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Link Url</b>

                                            <div class='graytext'>A Url for the Link (Put 'default' to the Article url redirect to Article Page)</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='link'
                                                                                                 value="default"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>
									
									 <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Article Url</b>

                                            <div class='graytext'>The url of the Article displayed on the Hotel Article Url ex: (/news/URL) (only put URL value in this INPUT please) (Only Valid when LINK URL = 'default')</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='url'
                                                                                                 value=""
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    </tr>


                                    <tr>
                                    <tr>
                                        <td align='center' class='tablesubheader' colspan='2'><input type='submit'
                                                                                                     value='Create'
                                                                                                     class='realbutton'
                                                                                                     accesskey='s'></td>
                                    </tr>
                                </table>
                            </div>
                        </form>
                        <script>
                            CKEDITOR.replace('text');
                        </script>
                        <?php endif; ?>

                        <?php if(isset($_GET['eid'])): ?>
                        <br><br>
                        <?php $row = \Azure\Database\Adapter::fetch_array(\Azure\Database\Adapter::secure_query("SELECT * FROM cms_articles WHERE id = :id", [':id' =>
                        \Azure\View\Misc::escape_text($_GET['eid'])])); ?>
                        <script src="//cdn.ckeditor.com/4.4.7/full/ckeditor.js"></script>
                        <form action='/theallseeingeye/web/articles' method='post'>
                            <input type="hidden" name="postearticle" value="1"/>
                            <input type="hidden" name="id" value="<?php echo $row['id']; ?>"/>

                            <div class='tableborder'>
                                <div class='tableheaderalt'>Edit an Article</div>

                                <table width='100%' cellspacing='0' cellpadding='5' align='center' border='0'>
                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Title</b>

                                            <div class='graytext'>A Title for the Article.</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='title'
                                                                                                 value="<?php echo $row['title']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Description</b>

                                            <div class='graytext'>A Description for the Article.</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='description'
                                                                                                 value="<?php echo $row['description']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>


                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Text of the Article</b>

                                            <div class='graytext'>The text of the Article.</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><textarea name="text"
                                                                                                    id="text"
                                                                                                    cols='60' rows='5'
                                                                                                    wrap='soft'
                                                                                                    class='multitext'><?php echo str_replace(['\r', '\n', '\\'], '', $row['text']); ?></textarea>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Image</b>

                                            <div class='graytext'>A Image for the Article,</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='image'
                                                                                                 value="<?php echo $row['image']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>
									
									<tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Categories</b>

                                            <div class='graytext'>Select the Article Categories IDs, separated by comma ','
											The available categories are.: 
											<?php
												foreach(\Azure\Database\Adapter::query("SELECT * FROM cms_articles_categories") as $categories):
													echo 'ID: ' . $categories['id'] . ' NAME: ' . $categories['translate'] . '<br>';
												endforeach;
											?>
											</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='categories' value="<?php echo $row['categories']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Image Thumbnail</b>

                                            <div class='graytext'>A Image Thumbnail for the Article,</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='imagemini'
                                                                                                 value="<?php echo $row['imagemini']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>


                                    <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Link Text</b>

                                            <div class='graytext'>A Text for the Link</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='link_text'
                                                                                                 value="<?php echo $row['link_text']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                   <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Link Url</b>

                                            <div class='graytext'>A Url for the Link (Put 'default' to the Article url redirect to Article Page)</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='link'
                                                                                                 value="<?php echo $row['external_link']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>
									
									 <tr>
                                        <td class='tablerow1' width='20%' valign='middle'><b>Article Url</b>

                                            <div class='graytext'>The url of the Article displayed on the Hotel Article Url ex: (/news/URL) (only put URL value in this INPUT please) (Only Valid when LINK URL = 'default')</div>
                                        </td>
                                        <td class='tablerow2' width='80%' valign='middle'><input type='text'
                                                                                                 name='url'
                                                                                                 value="<?php echo $row['internal_link']; ?>"
                                                                                                 size='30'
                                                                                                 class='textinput'></td>
                                    </tr>

                                    </tr>


                                    <tr>
                                    <tr>
                                        <td align='center' class='tablesubheader' colspan='2'><input type='submit'
                                                                                                     value='Edit'
                                                                                                     class='realbutton'
                                                                                                     accesskey='s'></td>
                                    </tr>
                                </table>
                            </div>
                        </form>
                        <script>
                            CKEDITOR.replace('text');
                        </script>
                        <?php endif; ?>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>